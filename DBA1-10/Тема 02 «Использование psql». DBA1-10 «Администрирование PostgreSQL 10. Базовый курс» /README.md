# Использование psql
 
## Назначение
- Терминальный клиент для работы с PostgreSQL
- Поставляется вместе с СУБД
- Используется администраторами и разработчиками для интерактивной работы и выполнения скриптов

Для работы с СУБД PostgreSQL существуют различные сторонние
инструменты, рассмотрение которых не входит в рамки курса.
В курсе мы будем использовать терминальный клиент psql:
- psql — это единственный клиент, поставляемый вместе с СУБД. 
- Навыки работы c psql пригодятся разработчикам и администраторам
   БД вне зависимости от того, с каким инструментом они будут работать
   дальше.
   https://postgrespro.ru/docs/postgresql/10/app-psql.html

## Подключение

- Запуск `$ psql -d база -U роль -h узел -p порт`
- Новое подключение в psql  `=> \c[onnect] база роль узел порт`
- Информация о текущем подключении `=> \conninfo`

При запуске `psql` нужно указать параметры подключения.
К обязательным параметрам подключения относятся: имя базы данных,
имя пользователя, имя сервера, номер порта. Если эти параметры не
указаны, `psql` попробует подключиться, используя значения по
умолчанию:
- база — совпадает с именем пользователя;
- роль — совпадает с именем пользователя ОС;
- узел — локальное соединение;
- порт — обычно 5432.

Значения по умолчанию позволяют пользователю postgres
подключаться к PosgtreSQL без указания параметров.
Если требуется выполнить новое подключение не выходя из `psql`, то
нужно выполнить команду `\connect`.
Команда `\conninfo` выдает информацию о текущем подключении.

Дополнительная информация о возможностях настройки подключения:
https://postgrespro.ru/docs/postgresql/10/libpq-envars.html
https://postgrespro.ru/docs/postgresql/10/libpq-pgservice.html
https://postgrespro.ru/docs/postgresql/10/libpq-pgpass.html

## Получение справки

* В командной строке ОС
  * `$ psql --help`
  * `$ man psql`
* В psql
  * => `\?` список команд psql
  * => `\? variables` переменные psql
  * => `\h[elp]` список команд SQL
  * => `\h команда` синтаксис команды SQL
  * => `\q` выход

Справочную информацию по psql можно получить не только в
документации, но и прямо в системе.

`psql` с ключом `--help` выдает справку по запуску. А если в системе
была установлена документация, то справочное руководство можно
получить командой `man psql`.

`psql` умеет выполнять команды SQL и свои собственные команды.
Внутри `psql` есть возможность получить список и краткое описание
команд `psql`. Все команды psql начинаются с обратной косой черты (\).
Команда `\help` выдает список команд SQL, которые поддерживает
сервер, а также синтаксис конкретной команды SQL.


И еще одна команда, которую полезно знать, хоть она и не имеет
отношения к справке, это `\q` — выход из psql.

## Файлы

* Скрипты при запуске psql
  * общий системный файл psqlrc
  * пользовательские файлы ~/.psqlrc
  

* История команд
  * пользовательские файлы ~/.psql_history
  * поиск по истории с помощью readline
  * количество хранимых команд можно изменить


При запуске `psql` выполняются команды, записанные в двух файлах —
общесистемном и пользовательском (если они есть, конечно).

Общий системный файл называется `psqlrc` и располагается в каталоге
`/usr/local/pgsql/etc` при обычной сборке из исходных кодов.

Расположение этого каталога можно узнать командой
`pg_config --sysconfdir`.

Пользовательский файл находится в домашнем каталоге пользователя
ОС и называется `.psqlrc`. Его расположение можно изменить, задав
переменную окружения `PSQLRC`.

В эти файлы можно записать команды, настраивающие `psql` —
например, изменить приглашение, включить вывод времени
выполнения команд и т. п.

История команд сохраняется в файле `.psql_history` в домашнем
каталоге пользователя. 

Расположение этого файла можно изменить,
задав переменную окружения `PSQL_HISTORY` или переменную `psql
HISTFILE`. 

По умолчанию хранится 500 последних команд; это число
можно изменить переменной `psql HISTSIZE`.

Пролистывать историю команд можно стрелками вверх и вниз, искать с
помощью `Ctrl+R` — доступен весь набор команд, предлагаемых readline